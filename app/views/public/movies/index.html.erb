<div class="container">
  <div class="row mt-3">
    <h1>感想投稿一覧</h1>
  </div>

  <div class="row">
    <div class="col-sm-3"></div>
    <div class="col-sm-6 col-xs-offset-3 text-center" style="margin-top: 25px;">
      <% if customer_signed_in? %>
        <%= form_with url:movies_path, method: :get, local: true do |f| %>
          <%= f.text_field 'search[value]', :placeholder => "感想タイトル or 原作名を入力してください" %>
          <%= f.select 'search[how]', options_for_select({ "完全一致" => "match", "前方一致" => "forward", "後方一致" => "backward", "部分一致" => "partical"  }) %>
          <%= f.submit :"検索" %>
        <% end %>
      <% end %>
    </div>
    <div class="col-sm-6"></div>
  </div>

  <div class="row">
    <div class="col-sm-8"></div>
    <div class="col-sm-2"></div>
    <div class="col-sm-2 my-3">
      <%= link_to "新規投稿", new_movie_path, class:"btn btn-primary btn-block" %>
    </div>
  </div>

  <div class="row">
    <% @movies.each do |movie| %>
      <table class="table table-bordered">
         <tr>
            <td class="align-middle" colspan="2">感想タイトル：<%= movie.title %></td>
            <td class="col-sm-2 text-center">
              <%= link_to '詳細', movie_path(movie.id), class:"btn btn-success btn-block" %>
            </td>
          </tr>
          <tr>
            <td class="col-sm-8" colspan="2">原作：<%= movie.original %></td>
            <td class="col-sm-4 text-center">ジャンル：<%= movie.genre.present? ? movie.genre.name : 'unknown' %></td>
          <tr>
            <td class="col-sm-4 movie-evaluation text-center" data-score="<%= movie.evaluation %>"><strong>評価：</strong></td>
            <td class="col-sm-4 text-center">
              <% if movie.favorited_by?(current_customer) %>
                <%= link_to movie_favorites_path(movie), method: :delete do %>
                  ♥<%= movie.favorites.count %> いいね
                <% end %>
              <% else %>
                <%= link_to movie_favorites_path(movie), method: :post do %>
                  ♡<%= movie.favorites.count %> いいね
                <% end %>
              <% end %>
            </td>
            <td class="col-sm-4 text-center"><%= movie.customer.name %></td>
          </tr>
      </table>
      <br>
    <% end %>
  </div>
  <div class="my-3"><%= paginate @movies %></div>
</div>

